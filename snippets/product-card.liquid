{% comment %}
  Product card logic: lead time & condition
{% endcomment %}
{% liquid
  assign product_condition = ''
  if product.metafields.ges.product_condition != null
    assign product_condition = product.metafields.ges.product_condition | replace: '["', '' | replace: '"]', ''
  elsif product.title contains 'Reconditioned'
    assign product_condition = 'Reconditioned'
  elsif product.title contains 'New'
    assign product_condition = 'New Surplus'
  elsif product.title contains 'Used'
    assign product_condition = 'Used'
  endif

  assign product_warranty = ''
  if product_condition == 'Reconditioned'
    assign product_warranty = '90-Day Operational Warranty'
  elsif product_condition == 'New Surplus' or product_condition == 'Used'

  endif

  assign lead_time = ''
  assign lt_min = product.metafields.ges['lead-time-min']
  assign lt_max = product.metafields.ges['lead-time-max']

  if lt_min or lt_max
    if lt_min != blank and lt_max != blank
      assign lead_time = 'Ships In ' | append: lt_min | append: ' to ' | append: lt_max | append: ' Business Days'
    elsif lt_min != blank
      assign computed_max = lt_min | plus: 2
      assign lead_time = 'Ships In ' | append: lt_min | append: ' to ' | append: computed_max | append: ' Business Days'
    elsif lt_max != blank
      assign computed_min = lt_max | minus: 2
      if computed_min < 1
        assign computed_min = 1
      endif
      assign lead_time = 'Ships In ' | append: computed_min | append: ' to ' | append: lt_max | append: ' Business Days'
    endif
  elsif product_condition == 'Reconditioned'
    assign lead_time = 'Ships In 5 - 9 Business Days'
  else
    assign lead_time = 'Ships In 1 - 2 Business Days'
  endif

  if product.metafields.ges.lead_time != blank
    assign lead_time = product.metafields.ges.lead_time
  endif
%}

{% comment %}
  Product card styles
{% endcomment %}
{% style %}
  .card-product {
    position: relative;
    border-radius: 5px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    background: #ffffff;
    border: 1px solid #f0f0f0;
    padding: .66rem;
  }
  
  .card-product:hover {
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
    border-color: #ccc;
  }
  
  .card-image-container {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: 5px;
    overflow: hidden;
    background: #fff;
    margin: auto;
  }
  
  .card-image {
    width: 100%;
    border-radius: 5px;
    object-fit: contain;
    transition: transform 0.5s ease;
  }
  
  .card-product:hover .card-image {
    transform: scale(1.1);
  }
  
  .card-info {
    font-size: 0.9rem;
  }
  
  .card-sku {
    font-size: .9rem;
    color: #6c757d;
    margin-block: 0.5rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .card-title {
    font-size: .95rem;
    font-weight: 600;
    line-height: 1.2;
    color: #212529;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    height: 2.5rem;
  }
  
  .card-meta {
    display: flex;
    flex-direction: column;
  }
  
  .card-meta-item {
    display: flex;
    align-items: center;
    font-size: .9rem;
    color: #495057;
  }
  
  .card-meta-item i {
    margin-right: 0.5rem;
    color: #334fb4;
    font-size: 1rem;
  }
  
  .card-price {
    display: flex;
    align-items: baseline;
    margin-top: .25rem;
  }
  
  .card-current-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: #334fb4;
  }
  
  .card-compare-price {
    font-size: 1rem;
    text-decoration: line-through;
    color: #dc3545;
    margin-left: 0.5rem;
  }
  
  .add-to-cart-btn {
    width: 100%;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 5px;
    transition: all 0.2s ease;
  }
  
  .add-to-cart-btn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }
  
  .card-condition-badge {
    position: absolute;
    top: .25rem;
    left: .25rem;
    background: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 5px;
    font-size: 0.8rem;
    font-weight: 600;
    z-index: 10;
  }
{% endstyle %}

{% comment %}
  Product card
{% endcomment %}
<a href="{{ product.url }}" style="text-decoration: none;">
<div class="card-product">
  <div class="card-image-container">
    {% if product_condition != blank %}
      <div class="card-condition-badge">Collection Badge</div>
    {% endif %}
    <img class="card-image" src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}" loading="lazy">
  </div>

  <span style="width: 100%; height: 1rem; margin-top: 0; margin-bottom: .25rem;"><div style="width: 100%; height: 1px; background-color: #ccc; margin-top: .5rem;"></div></span>

  <div class="card-info">
    <div class="card-sku">{{ product.selected_or_first_available_variant.sku }}</div>

    <div class="card-title">
      {{ product.title | remove: '- New Surplus' | remove: '- New' | remove: '- Used' | remove: '- Reconditioned' | strip }}
    </div>

    {% assign review_count = product.metafields.loox.num_reviews | default: 0 %}
{% assign rating = product.metafields.loox.avg_rating | round: 1 | default: 0 %}
<div class="card-meta-item" style="margin-top: 0; margin-bottom: .25rem;">
  {% if review_count > 0 and rating >= 3 %}
    {% render 'product-rating-badge', product: product %}
  {% else %}
    <span style="width: 100%; height: 1rem; margin-top: 0; margin-bottom: .25rem;">No Reviews</span>
  {% endif %}
</div>

    {% if product_condition != blank %}
      <div class="card-meta">
        <div class="card-meta-item">
          <i class="bi bi-tag"></i>
          <span>{{ product_condition }}</span>
        </div>
      </div>
    {% endif %}

    {% if lead_time != blank %}
      <div class="card-meta">
        <div class="card-meta-item">
          <i class="bi bi-truck"></i>
          <span>{{ lead_time }}</span>
        </div>
      </div>
    {% endif %}

    {% if product.selected_or_first_available_variant.available %}
      <div class="card-meta">
        <div class="card-meta-item">
          <i class="bi bi-check-circle text-success"></i>
          <span>In Stock</span>
        </div>
      </div>
    {% else %}
      <div class="card-meta">
        <div class="card-meta-item">
          <i class="bi bi-x-circle text-danger"></i>
          <span>Out of Stock</span>
        </div>
      </div>
    {% endif %}

    <div class="card-price">
      <div class="card-current-price">{{ product.selected_or_first_available_variant.price | money }}</div>
      {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
        <div class="card-compare-price">{{ product.selected_or_first_available_variant.compare_at_price | money }}</div>
      {% endif %}
    </div>

    <span style="width: 100%; height: 1rem; margin-top: 0; margin-bottom: .25rem;"><div style="width: 100%; height: 1px; background-color: #ccc; margin-top: .5rem;"></div></span>

  </div>
</div>
</a>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
