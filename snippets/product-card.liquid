{% comment %}
  Product card logic: lead time & condition
{% endcomment %}
{% liquid
  assign product_condition = ''
  if product.metafields.ges.product_condition != null
    assign product_condition = product.metafields.ges.product_condition | replace: '["', '' | replace: '"]', ''
  elsif product.title contains 'Reconditioned'
    assign product_condition = 'Reconditioned'
  elsif product.title contains 'New'
    assign product_condition = 'New Surplus'
  elsif product.title contains 'Used'
    assign product_condition = 'Used'
  endif

  assign product_warranty = ''
  if product_condition == 'Reconditioned'
    assign product_warranty = '90-Day Operational Warranty'
  elsif product_condition == 'New Surplus' or product_condition == 'Used'
    assign product_warranty = 'Ships fast!'
  endif

  assign lead_time = ''
  assign lt_min = product.metafields.ges['lead-time-min']
  assign lt_max = product.metafields.ges['lead-time-max']

  if lt_min or lt_max
    if lt_min != blank and lt_max != blank
      assign lead_time = 'Ships In ' | append: lt_min | append: ' to ' | append: lt_max | append: ' Business Days'
    elsif lt_min != blank
      assign computed_max = lt_min | plus: 2
      assign lead_time = 'Ships In ' | append: lt_min | append: ' to ' | append: computed_max | append: ' Business Days'
    elsif lt_max != blank
      assign computed_min = lt_max | minus: 2
      if computed_min < 1
        assign computed_min = 1
      endif
      assign lead_time = 'Ships In ' | append: computed_min | append: ' to ' | append: lt_max | append: ' Business Days'
    endif
  elsif product_condition == 'Reconditioned'
    assign lead_time = 'Ships In 5 - 9 Business Days'
  else
    assign lead_time = 'Ships In 1 - 2 Business Days'
  endif

  if product.metafields.ges.lead_time != blank
    assign lead_time = product.metafields.ges.lead_time
  endif
%}

{% comment %}
  Product card styles
{% endcomment %}
{% style %}
  .product-card {
    position: relative;
    border-radius: 5px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    background: #ffffff;
    border: 1px solid #f0f0f0;
  }
  
  .product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
    border-color: #e0e0e0;
  }
  
  .product-image-container {
    position: relative;
    height: 240px;
    overflow: hidden;
    background: #f9f9f9;
  }
  
  .product-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.5s ease;
  }
  
  .product-card:hover .product-image {
    transform: scale(1.08);
  }
  
  .product-info {
    padding: 1rem;
  }
  
  .product-sku {
    font-size: 0.8rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }
  
  .product-title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.4;
    margin-bottom: 0.5rem;
    color: #212529;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    height: 3rem;
  }
  
  .product-meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .meta-item {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    color: #495057;
  }
  
  .meta-item i {
    margin-right: 0.5rem;
    color: #334fb4;
    font-size: 1rem;
  }
  
  .product-price {
    display: flex;
    align-items: baseline;
    margin: 1rem 0;
  }
  
  .current-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: #334fb4;
  }
  
  .compare-price {
    font-size: 1rem;
    text-decoration: line-through;
    color: #dc3545;
    margin-left: 0.5rem;
  }
  
  .add-to-cart-btn {
    width: 100%;
    padding: 0.5rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 5px;
    transition: all 0.2s ease;
  }
  
  .add-to-cart-btn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }
  
  .condition-badge {
    position: absolute;
    top: .5rem;
    left: .5rem;
    background: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 5px;
    font-size: 0.8rem;
    font-weight: 600;
    z-index: 10;
  }
{% endstyle %}

{% comment %}
  Product card
{% endcomment %}
<div class="product-card">
  <div class="product-image-container">
    {% if product_condition != blank %}
      <div class="condition-badge">{{ product_condition }}</div>
    {% endif %}
    <img class="product-image" src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}" loading="lazy">
  </div>
  
  <div class="product-info">
    <div class="product-sku">SKU: {{ product.selected_or_first_available_variant.sku }}</div>
    
    <h2 class="product-title">
      {{ product.title | remove: '- New Surplus' | remove: '- New' | remove: '- Used' | remove: '- Reconditioned' | strip }}
    </h2>
    
    <div class="product-meta">
      {% if lead_time != blank %}
        <div class="meta-item">
          <i class="bi bi-truck"></i>
          <span>{{ lead_time }}</span>
        </div>
      {% endif %}
      
      {% if product_warranty != blank %}
        <div class="meta-item">
          <i class="bi bi-shield-check"></i>
          <span>{{ product_warranty }}</span>
        </div>
      {% endif %}
    </div>
    
    <div class="product-price">
      <div class="current-price">{{ product.selected_or_first_available_variant.price | money }}</div>
      {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
        <div class="compare-price">{{ product.selected_or_first_available_variant.compare_at_price | money }}</div>
      {% endif %}
    </div>
    
    <button class="btn btn-primary add-to-cart-btn" type="submit" name="add">
      <i class="bi bi-cart-plus me-2"></i>
      {% if product.selected_or_first_available_variant.available %}
        {{ 'product.add_to_cart' | t }}
      {% else %}
        {{ 'product.sold_out' | t }}
      {% endif %}
    </button>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
