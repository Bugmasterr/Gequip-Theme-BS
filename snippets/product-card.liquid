{% comment %}
  Product card logic: lead time & condition
{% endcomment %}
{% liquid
  assign show_collection_badge = false
  assign variant = product.selected_or_first_available_variant
  
  assign product_condition = ''
  if product.metafields.ges.product_condition != null
    assign product_condition = product.metafields.ges.product_condition | replace: '["', '' | replace: '"]', ''
  elsif product.title contains 'Reconditioned'
    assign product_condition = 'Reconditioned'
  elsif product.title contains 'New'
    assign product_condition = 'New Surplus'
  elsif product.title contains 'Used'
    assign product_condition = 'Used'
  endif
%}

{% comment %}
  Product card
{% endcomment %}
{% assign card_classes = 'card-link' %}{% unless product.available %}{% assign card_classes = card_classes | append: ' sold-out-card' %}{% endunless %}
<a href="{{ product.url }}" class="{{ card_classes }}">
<div class="card-product">
  {% unless product.available %}
    <div class="sold-out-badge">
      <i class="bi bi-x-circle" style="color: #dc3545;"></i> OUT OF STOCK
    </div>
    <button type="button" class="notify-available-btn" data-product-id={{ product.id | json }} data-variant-id={{ variant.id | json }} aria-label="Notify when available">
      <i class="bi bi-bell"></i> Notify When Available
    </button>
  {% endunless %}
  <div class="card-image-container">
    {% if show_collection_badge and product_condition != blank %}
      <div class="card-condition-badge">Collection Badge</div>
    {% endif %}
    <div class="info-icon">
      <i class="bi bi-info-square"></i>
      <i class="bi bi-info-square-fill"></i>
      <span class="tooltip" role="tooltip">
        {{ product.metafields.seo.meta_description | default: product.description | strip_html | truncate: 160 }}
      </span>
    </div>
    <div class="card-image-container-inner">
      {% assign img_url = product.featured_image | image_url: width: 256 %}
      <img 
        src="{{ img_url | asset_url }}"
        class="card-image{% unless variant.available %} unavailable{% endunless %}"
        loading="lazy"
        srcset="
          {{ product.featured_image | image_url: width: 256 }} 256w,
        "
        sizes="(max-width: 768px) 50vw, 25vw"
        alt="{{ product.title | escape }}"
        width="256"
        height="256"
      >
    </div>
  </div>

<div class="card-divider"></div>

  <div class="card-info">
    <div class="card-sku">{{ variant.sku }}</div>

    <div class="card-title">
      {{ product.title | remove: '- New Surplus' | remove: '- New' | remove: '- Used' | remove: '- Reconditioned' | strip }}
    </div>

{% capture rating_content %}
  {% render 'product-rating-badge', product: product %}
{% endcapture %}

{% if rating_content %}
  <span class="rating-badge">
    {{ rating_content }}
  </span>
{% endif %}

<div class="card-meta d-flex">
  {% if product_condition != blank %}
    <span class="card-meta-item d-flex">
      <i class="bi bi-tag me-1"></i>
      <span style="font-size: .9em;">{{ product_condition }}</span>
    </span>
  {% endif %}
</div>

<div class="card-price mt-2">
  <span class="card-current-price">{{ variant.price | money }}</span>
</div>
    
    {% if variant.compare_at_price > variant.price %}
      {% assign savings = variant.compare_at_price | minus: variant.price %}
      <div>
        <div style="padding: 0; margin: .5rem 0; line-height: 0;">
          <span>
            <span class="card-compare-price">{{ variant.compare_at_price | money }}</span>
            <span class="savings">Save {{ savings | money_without_trailing_zeros }}</span>
          </span>
        </div>
      </div>
    {% endif %}

    <span style="width: 100%; height: 1rem; margin-top: 0; margin-bottom: .25rem;"><div style="width: 100%; height: 1px; background-color: #ccc; margin-top: .5rem; margin-bottom: .5rem;"></div></span>
  </div>
</div>
</a>

{% unless product.available %}
<!-- Notify available button CSS moved to assets/product-card.css -->

{% endunless %}
